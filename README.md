# K-Lines clustering - Line Detection
> By Frank Lai, Nick Shaju

This project is able to extract line features from 3D line data using a method similar to K-means clustering. This project targets the neiche of 3d pointclouds generated by lidars with know variance. Initial value lines are generated. Using Loydâ€™s algorithm, clusters are determined using the current line of best fit and a new line of best fit will be updated iteratively. Using simple clustering comes with a few drawbacks. K means clustering requires a known number of clusters to compute. It also considers all the points in one cluster or another causing error due to outliers and false detections. K means clustering is also unable to reject clusters that do not represent lines in 3D space. To circumvent these issues, the following 3 assumptions are made about the point cloud data:

1. The data comes from a lidar and the variance of the data is given or can be experimentally determined
2. Data in the point cloud represents real objects so they can only form a line or a surface. Each line segment has a continuous line of points in them.
3. Lidar is high enough resolution that any line of interest should have a significant number of points in them.

Using assumption 1, it is possible to reject outliers if a probability threshold p is heuristically determined. This has the effect of creating an inclusion cylinder around each line of best fit that only considers particular points close enough to be in the cluster. Using assumption 2, it is possible to determine the length of each line segment and split up clusters into multiple line segments if two clusters are too far from each other. The distance threshold for clusters is determined by the variance values of the data. Using assumption 3, it is possible to destruct clusters that cannot gather enough points as they likely do not represent lines. Finally, using these assumptions it is possible to increase the number of clusters. Since using this method, it is possible for a point to be considered part of no clusters, after a set amount of iterations, if there is a significant number of points that are not part of any cluster, they will all be considered part of one cluster, a new line segment can be generated and will be broken down and filtered using the previously mentioned methods.

## testing results:
With the tests currently specified in tests.py, the python implementation of the proposed method is able to significantly outpreform hough transform in terms of accuracy although much slower. Further testing and optimization will be required to see if there can be any improvements on speed of the algorithm.


## How to run
Install dependencies 
```
pip install -r requirements.txt
```
Then run ```tests.py``` as an executable with the command line arguments below

Example:
```
python tests.py 1 -i 15
```

## Command Line Arguments
```
test: Number id of the test. Currently 3 tests supported with ids [1,2,3]. Corresponds to the test numbers as seen in the report. Required

-i: --iterations: Number of iterations to run the fit function. Default: 20

-o: --output: if used, test point cloud data will be outputted to a txt file in the format x,y,z entries per row. Default: False

-v: if used, outputs figures and text for each single iteration. Default: False
```
